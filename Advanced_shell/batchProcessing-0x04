#!/bin/bash

# Task 5 — Parallel Data Fetching

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data_parallel"

mkdir -p "$OUTPUT_DIR"

echo "Starting parallel Pokémon data fetch..."

# Array to hold all background PIDs
pids=()

for pokemon in "${POKEMON_LIST[@]}"; do
    (
        echo "Fetching data for $pokemon..."

        API_URL="https://pokeapi.co/api/v2/pokemon/$pokemon"
        OUTPUT_FILE="$OUTPUT_DIR/${pokemon}.json"

        response=$(curl -s -w "%{http_code}" "$API_URL" -o "$OUTPUT_FILE")
        http_code="$response"

        if [ "$http_code" -eq 200 ]; then
            echo "Saved data to $OUTPUT_FILE ✅"
        else
            echo "Failed to fetch $pokemon (HTTP $http_code)" >> errors.txt
        fi
    ) &
    
    # Store PID of the background job
    pids+=($!)
done

# Wait for all background processes to finish
for pid in "${pids[@]}"; do
    wait "$pid"
done

echo "All parallel fetch operations completed."
